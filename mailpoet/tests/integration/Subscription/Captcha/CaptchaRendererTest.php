<?php declare(strict_types = 1);

namespace MailPoet\Test\Subscription\Captcha;

use MailPoet\Subscription\Captcha\CaptchaRenderer;
use MailPoet\Subscription\Captcha\CaptchaSession;

class CaptchaRendererTest extends \MailPoetTest {
  private CaptchaRenderer $testee;
  private CaptchaSession $session;

  public function _before() {
    $this->testee = $this->diContainer->get(CaptchaRenderer::class);
    $this->session = $this->diContainer->get(CaptchaSession::class);
  }

  public function testItRendersImage(): void {
    $sessionId = '123';
    $this->session->setCaptchaHash($sessionId, ['phrase' => 'a']);
    $this->testee->renderImage($sessionId);
    $this->assertStringContainsString('JPEG', $this->getActualOutputForAssertion());
  }

  public function testItRendersAudio(): void {
    $sessionId = '123';
    $this->session->setCaptchaHash($sessionId, ['phrase' => 'a']);
    $this->testee->renderAudio($sessionId);
    $this->assertSame(
      hex2bin('fffb90c4000000000000000000000000000000000058696e670000000f0000003600001a1c00070b0b10101818232328282d313136363a3a42424b4b5151565a5a5e5e626267676b6b6f6f7378787c7c8080848489898d919195959a9a9e9ea2a2a6a6abafafb3b3b7b7bcbcc0c0c4c4c8cdcdd1d1d5d5d9d9dedee2e2e6eaeaefeff3f3f7f7fbfbff000000394c414d45332e3130300253000000000000000014202405c74200002000001a1c9fa68892000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffb40c4000004ac0349b41180218998693732c0000402ded3259b880037880100c1707e50138a0208f287383f2e0f9af07c3ef94043ffb20f83e00ada8e59b5ae472365220000009794ca1321018f254cc755a676531c8d632d6e56f329230363db456aae06a794323b609c66bcc5e815b302b5e9a9f43c5f4d55edfac6986df48cae861859c85fcdfc7ef7f9fa5fa97b7fce6757a65f30083f597e4900c762481020004308ce9452276e1fc2d7672acc5895ddb36afffb10c40c8046804f479d818000cd8668918498c0a88624ac87cf4b1a4c7a2aa1945491b3e27710a75b3eda86ada88d0166da640f8849ec29f77aa2eb45b61604061204c38b08da1d3af870b8a0b1959318a5abcd0e416864b398fd39d2c850fa46bdca05bf348dfffb20c4020007186b4da7a46340cb88a970f488e0b8ca240006807b463a282217489881c3466245023402405308471f99ae14c4745d84ac23663274061975ed4623b9edeb0adca4ac5407a491c2d2a000521563c66532a15e8a4274998166d65d24713ecbc2306b5cdb065a10458b1cd1acb271c03454abecdec7a74d00ba9a20acfffb40c4028007647745758180098519a82730c000076b26ba94c12fc4be112a96525150c6fb2da19da8a381ba2be27f7ac77acca133fa85c2ecb4e0ecb7a71bd7a4ece8b9f8effeef6ced81fab7dea4d2880000079d8804ae07136aa84a1acbaaf8b516072696482ef682848909c19b8bd497c26362a89319e6b31aa4353642c3ffe5d5d655b1136bb22725ceac4d38b2d1c1142f5b226173b7eca3734debe4badfb9993af5988ff881d9620a005b258d4b6c8ed6d2fffb60c404800c50cd4db98600018a1c2c7b1eb00000900000026d3aad32b06721d8950b80ffc76c5e7f9ed81652f8d6aaea43ba1c4b159f14959518347b213aacb977ad45ee9e7a57c2b79631475139562b34dccb77b37dbd9c8baedcf54cd5c3bcc513c7b467b2f1df93f247f92355788977993423300c208100003ad901aea326aa0ccd058981790c8ac334b040f81386242dd2e3b01238274ef2601397b1a401387a739578fe3786e3e1a1246d2a5a3d7bd86e4f372631fcb8d4e5cdedd899bd9a1cb9dcea24adf5f7b3fffe336f9a01379997553000000103e07c700d6a30381001b97872390f46b3b3d64f0b4cb431d0c413d2d8beece6bb624cadd5b7f3f26df264fffb20c41a000918a355dcc300090e926af8c30dd1b87c992d526e5e54b76ec47ff177dfee850e58a91806629a5d94e4aa00660d0479380ace8111202028bc7a3f612dc58a04d0346f30f557c6d657a6e42e02a3faec6723a12b9ec4f544ada4242c55fa970effdf5435db2d9495012da224071166b1f9f084ed618c4373b16a35a7fffb20c40a00c77c954a8c306380ea8ea911830d38cfc3305f4a82f31d042c63b37c30006ac2a1b927b9a9741b3cdee4ac59770e41dce84408e4374e28264d9c01035d0561a5cee0d5d4aadc1ab1095d10583bd1c1c8647289f7a79a677387219ac761aca53e5dc1a024078811199cdc786117b0a35d3c8502daed49a328001864cafffb10c4050005282d53861864c0a985a9f0f7980030544ac109a4b1107541a943124c12257cc9c54e5eb18a171407799caead7a82ccdac822d00030cfd0e85fb0958464f3d2591972105e2019857ac8c71053242484a1122fd759332d774a0148e425ec0c859865fffb10c404804468415367a4c0008c862a70f6180cc758c36d0821679c85cecc42a3be21b87732920b9c7d69f57b3a805634ca324028c95843860822479fd3392ee66b54b291caa4093e293917da3cd0d57d554b6d7571b8d80000406c72cccd50bd73982c587e30fffb10c40a8004a44f6da49846f09307ee7698600694f1c67d4bd95dddd850954616ceeb349576d75d9b9030006635322a444c5ebba0a34f4bc95a7734a1373911125dd7f9e92b69ffd20036892ca4948ebd69000000ffb390e51a7a6642a58d097f3c4b5a3d2a87fffb50c40f000c44bf45999600018799aa771ec000eb5790cb04b2e9049a88212a18f139870ed0138e25e1dcd44a220949125f1b5e7507af679d7aeae75aba8757d1e9ddfb7cb333b8e44d4d20dcad76d5d9de7c193b6f6f02903fd75cdfdbedfdf645212000013b3c822198565d34870a51c0a1566cfd5725d2d61793561b1ca83e5c645c357da74e1f37549cf55bca8ccd7798447f0bc85ad3b05998fd972b551579dac1f4bdb79f99f97f760acccfedff6b3bedfb6dc7ce3f933da30a0080d3ad535440a0c358ce56e8c3b93b8da4fffb50c40a800bcced3c19a58009889e280334f00021ea8cc0c980c01f0e188279a12553abb87594349c6ea5497da05c7dea6f55eeb3dda86ad4ede68c93c7e1637b3af97b9ca6d6a3be56374adafe68e42a7936b1e5c69ffe896adffeab08789f25a151039015903f5013f8dac313ab866a039b5fd0f7471b0a253a3e54fb0d28c6e4ca9372a62f9d5aaab43192b789fef54c56ac0c94b6615a7b5f7f7edabb3c47ba78c9efabd695be33bdeedb919345b05b0bc7acbfffffd42ffffd1e7e178a005b1d93497db6ef1c4080000002c4fffb30c407800c54cd57b8f600008b856ef7925006c82892a60ac2a0b09a62e6751756aef6e9498c08c068038803b9a16a026ab4d51fd6ad0068d7517a2f5cb0fa266933abad0d73695bd58d6976bb92fcecdaf6ddd6aecad491bb33df6bd272d5e99abd4e68fe90f49afd75b2cb40000060587da2457b08cac88e6cc27d9806ac22c7489aa6e9a5e5d9b2aa026d6d75ff80004cc015855506992279fffb10c40800446431598498c4e089856ab0c10d00e412c93ce383264ace0556928aad04b0a2ba34031c76268b00d89a83cbe8f5973f0ef6186380584814599f089e8a8b06cebbfffffe9a31c92d92660800e2203a150320773ce3e8a26b57d35d038164996945b7fffb10c40e80444c2d658324c0308a03eab0c61804d4dffffd1d014b1e6e4bc81c220104606d2ae7bb966201e1a09980d07d56125a17552a365bfef5532edd2d927f80008f018894549470f0c21e4e398c2cd820074860e07c30f723daed0011f991863e8c463a15fffb10c415804450256784a500b08e0368d583184824eadba23c080d2c7963699a5b0a1a3a9fd6d95daa68a35bd5dfeb34777779777db6a00000d41948093c4ea8116570b46f369ca8738dc88454317f349b358d1c23e1f80996dac7206ded85224a41fa1489ca92fffb10c41c00449c317de314c0308c85a880f60c18f5994e83e5eea4952a453fa48df9ed0a56dbb6b7470000004d21295614094105d9a4c20084246eb23adf34da45603967f7a964048a52fdbddb5a230b601c842821743cc0a411b05c89906dc20262ab31152686fffb10c4218044a03769a618c43082042e746098c6fa3ea5035e525500006d0838592801815320e5e8a59c2712921088455ea34f30e6d356eeb77ef139776daeb6d8032f02faca08a71496827a81376eac1a99294c9094d0657ac1d494da0fc2002640c091aa1402fffb10c4280044941d492798c240850a6df4948c6e6a69cf109859c5306810a871d78bad87bae2c973a6f5dedfeffa004a24da70a0800af9a6ceae7270d56f58537b5b58341840b0c100781f58af4235f72bfd358ce8b6b9bd26b76da4d106800000cb4b8bb13849fffb10c42e8044882546aca04280908569b29e20002bdd37341083ca2eb4250b9980c0cb24c7b9982a99901e6461ee4f17c904e9ac79ad2344cd0dc59bb5e504e92015a3847238eeaa83e87940cf437b5f64dcd0ccdeb42797ffa17fe759c019ea029900a24e9b91fffb10c433800b98f177b8f68010958bad039e800061d6f2ef3fd0bb094a15163625cc832aaff7efb7b933fb3ffffeb5aa4a2d2f89b92c0001c6743f343465c125f557c64e52ae15d295e35bc92400381586febfb811ac003200a2a50423919cdf0eb24b03590d33fffb10c41b8004785f93a488cf309187ee64f30cd03a574140441d1a30405e9d0d0f7f47fff4d50109a60022a00001614589fab138fc39308c0f52b35d494c1aab65e2c9c8364df7010ba3f522969f1018586058c010a0b0ca07305bc2519abd4ae023da0d80801efffb10c4208044a4457da61906a0858670349308dc906d2dfbdaf505bd372020b70001636c81701393b460a61a7118b47951c207db0d86ddda5c1bfd05d9a9a6f6999453b2c0578417263ba5c748e0dd74a473c69c6970925ffe90a501a676319a15ae3047187b73fffb10c4268044783183a49865008a0bb234908a0e63c426a95928a1b4139f7979a750c3d19463096aec2203f633fac8206c0b3d006396e580dc3b09a948a269f6e4b7c61f762a1c1648b528a87f6ffa5d42219f4a0024ec6041700583f80d879b1ad56e498e966bfffb10c42c804458476a0c30c5888b8bee64f48cb02d90851190a1ed8290eeb6eaa3fb5ee160501f2f064d3bc9a81e4446f68125d3065b03091f019115c617662e9cd2b6abb1c5ab18832ffae084aa13e8277fdeffca2200492e85229468014289b0f53b0d65f632fffb10c4330045a0477f8488ceb09f0c30709308e698a00e8a4cc3f78f0aa64ca5321eaaebc19af384374f4506916c737d5dd40ceef27ff72975951bf06647dc59de3c481155e10cda7649dd45c85e54b3105184e0513891976ddafda2a1284cfde06d86f2525f2dfffb10c4320047d8a177a7b047d0d214713cc489a6581337ffa3a2215136dfa8037f6f89aa284b2688929c64012803d9806942d16097651f4530f327069415a110cb2aa9be572bdbb8a156cfff5cd9951deb66a0700b7fe84ea36003aee88005ba4e6a25381d12b4fffb10c4218046aca581a60caf30b18bedf5848c981d7231b1d6880909103319d1bc290133257141ce53ff60ea420f7e81c06fae0016e4400180070769502f438c3cb3691489c8cf074aa71c0986b4d3f1a69c94898101dfe412136db14418f04805c3795c3343a2fffb10c41a0044a8456d878cc7408704f0b4f5a406365976ca56b26223d003a28deab0eff586bf1400376540001c0001c9daf16a060e1529324d3adea4dd93a8afeebfabcafffff42b3ffec0d082effea4b760b2c821df2cf18a28d22c9252f96c8ecb1a4d0917ccfffb10c420004498a375a7a0435086873030c308ae8144d7fe25fd15005bb7a990a300010f834234204a9932dae97417608db2289563fa562aa6fd810dfc81d004affc082eee2f5b03d1639e2cb14ab8f3ec336d519379577b729dc29697fcb27ea10a0f00041825fffb10c426004470397fa39843708c8bedf4f188e061c314ad803f6a39c52723ec977f406d846b26a69c8103e3658f384e09a9bfa08459e1e1d524b259e1890d260034a21a5be799dcc35a1a6cab90aa858a840b7f696a40ddbfcdd7e004058d2816c032214b4130fffb10c42c0044985960ac0cc5408705b13c911846453a82005024aa1f89af8baddfef29f48082c2b33192324d289860d69206415d68b0347c42707b9fb57a651f1ff5828004ee92012588675424a38000308442848ac9a62025404418a43071e79e02e2fedb80dffffb10c432004424217b8324c0308b83ef3c639846d068016d9632b92f002051908d9b4df684ee12930ca6ce294f9bb285b0f44a29fc67d7234788a9875b75a00022253848478e611af00304935100d3089005c9627584a28076042c57ee7a00135f294656d5bc69fffb10c4398044382777e4a464b08484ecf0c48c26c996de845ac3eaeef262dc2a3b9e6b81ff2f7a53b08af5c77032da56d578c3aa25ebadae371a0000151405570c342a259686d1dd02903cd30fbf6a86718d03181a80a9ac2cd3e197d54338a800bccccbaad9adfffb10c4418044e82b81e484c830a30aeb35860c6c5c1305a6198cd507114fa94968351a98a8233af0c9bad650a3ce045c6f6a6a378b2a026e02406946f507399a10928b2cd2a908b2114870e0b906894f12322e2a974ddfa5d60413fd3fdf6364405acaeb6d49d2fffb10c4430045743967a4986a70a205abfc93984420699f21119cb47a7260787719a861e04739ee1a27c8d606db9ea16f6a2a01496469d0c0010895bc0d610125dd1a732a6379d456b0762a44d09aeaa8eb9162e9628ba0b4ea92b730055b11384e9a38b7bbd023fffb10c44200454825470c24c2809005aa70f48c5c758e20d089c2031c3ca8477294f349a7f4550eddaebac7000000738acc01b0fcb56b8ad9b492c8d38145ce8a18515b73e6dfed4176e27b79adba490005315642152c3d0371cc432c5892897bd8307cf44c3537fffb10c44400449827518c24c0008585aa70908d8438a23d631885369058a35e8d0b4bad21f3cdf6622704c8880f343a41b0e4460024e6b2cf8a6ecf759df54904a748d2a000710540e5731b8c0e39446e4a982902a1f2619cf1c1bb146aab397a96decfd405dd5ffffb10c44a0044743b6da4846e388b872df4360c1ee0225b5801199138fac353516a4ccad4b4ab480446a04da610a66c5aefa1f6569386c50260bd28578c0162881a7732e7114b218b342811480d1c263c48a17e2c9e7fffb75a6a42798898787db6a00004bbbd2dfffb10c4500004a41d460c2d22409304a9a4f798001c138568d8b22501a20748204c9102d8a6b8fd09f9b6ddd60ddea2ca0b2308436e46c9a9d2082d46c6974192409a8468595aea7ebf7b3aa82b4b7796b923000003588a8d012735cddd628b9ea3a552821b264afffb10c4548044702b4d0c3cc040930628818618400e3411671bc96f53d578f881b800a39121e55c2ee6f195a62405c50b054ccb3da4929223e8bb146d37d527a3fa6a02ee50e50001a62063d6ecfeca4e8b0bb20c520f76631d6c9d75d01984a9eba48b2be34f56fffb10c45980449c3581e61846f08084a9a507980002494a8aba1001021772244b83465390885090a830462a7c985154d2034b9cfd2a56bffaaa6f7fbfff5b6c00002d8350904212323bab9229136398c340aa45eeb508bd16d65a8a95d54005491421421de3c884fffb10c460804494256da32580308e8328d58c2400110406a6b4611313022cbbb3ce16344cc531c7f4ffe8e03adcba2cc99005a58c82c459dbab1bd1945623534516c3025653675b746b555ad3fa74e4456a50440d362e41460d824125e72485d6cdd529cc03e167fffb10c46580049c4d4b27984500918469f1810c40d454b249b6c67eeec14ab27517bed2b50004b292018a0e9116b3131925991451d8c509e6c585c00a10e90d8264d23b15d352988fabd4a6acef110cf75a01ac314766949168e687e99031787583c35765f1100dfffb10c46a0044942777a324c2708b856971831840e0bd4cbbd032ddbedbdb23000001503e8f0a1a88450d20aa17ba7b47000a210420a933d6841a4c18ebd7d7bfa4011e71c735b2cbb46c9400000000506f86ff0e09de30c95f490d20770c0696e4fed14cd6c0b7fffb10c46f80042829440c1862808c8568e18498082084ac5230188f6e9816490f1e5dbc46844e3342ab2d426689d5ba66e34b5f5c623d1f2cd8a8f4d27e5beb5dfcaf7efcecccd27e7a62c0f156378af51b0000246db4524f2c65000015a21a0541a1a435e56f4afffb10c47680453c29492c18c00088052f3cf3180611c1a597b5c4de5988e4ec4033adae2a585dc01c09139d2c71222886c226e0856429222ae6d05e9c2b94a28fe9292889edb5495136b7bb4da572f6d35d2cea47c99c92c4cee0a094a03fe779912fa2cd67d480fffb10c47a0004f8336fb46180318d17a93730c00008f9de6fc099cf6a45f375c72dd01376cc31414d02c612b0490c34127dfc72214de38fea12953cf4fd5533a80005209b02e2ac0a28b9748d0941e0bbdb40c304701c07c1c6b54c36928750690b58e3a1b0300afffb10c45e000c50bd4f99848000bf852b339e20047fb87c8d676f73ee160058345564591c8c0005dce20668d23271061b81d3c86d2b6d83c45c481f6834750a5bc6296ab834b0ce9b400838e7a105737bd5009a7686657b6d8c000a8190e951b998b2254f914c61fffb10c43e0006402f44a7a46340cd04eb3cf4a40401b51f68a221913863cc51a454d2d8f1b345075854780ef6cb6df4957c93ed6491aa3e62e8eef89a0c4b4426137a2048dd07c24660805ad5d3b72eaee7fe0c7c5e256c944f3e8d1be5af3eb330c80017c24609fffb10c434804624375be62466e0c3862d349618178e85cb1e6f48431f9b986209d3fa5b96f2e222ed43c5ecd4068b2d9b93f42598ebaa090f87e0260284043472420995088c90ef6f20f10444ac832452314d9d32ab5ae1748d45028d5257fd75aa065dbefb496bfffb10c42d0045203344ac24c040a884e8e18798000000092b428c9fbcb5a6a369f721cb1d120a9505a441f985edd2e7ef4253b95006c042d758d4561a090000000061f611d834255d8f19599c420ea5affb69996d5967fab48380ea1f58dad162825e8bf215ff53fffb10c42c8004ac255bb4c080218c16e8b732f0001be4dc97b11caa438bffc9dc2ba91bd4c851db193bfffe2c3ae626a23d923bebfffff344cef399a683ab427cde63c2550608c20119baa5c5011241808f02c0d2c345b4561a507560d3c4bbbffcab844f5034b0fffb10c41183c4741eb8dc30800000003480000004d24c414d45332e313030aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'),
      $this->getActualOutputForAssertion()
    );
  }
}
